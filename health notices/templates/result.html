<!DOCTYPE html>
<html lang="en">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Safety Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4"><i class="bi bi-shield-check"></i> Weather Safety for {{ location }}</h1>
        <div class="row g-4">
            <div class="col-md-6">
                <div class="card shadow animate__fadeIn">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-thermometer-half"></i> Current Weather</h5>
                        <p class="card-text">Temperature: {{ temp }}°C</p>
                        <p class="card-text">Humidity: {{ humidity }}%</p>
                        <p class="card-text">Wind Speed: {{ wind_speed }} km/h</p>
                        <p class="card-text"><strong>Condition:</strong> {{ condition }}</p>
                    </div>
                </div>
                <div class="card shadow mt-4 animate__fadeIn">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-sun"></i> UV Index (Current)</h5>
                        <canvas id="uvChart" height="200"></canvas>
                    </div>
                </div>
                <div class="card shadow mt-4 animate__fadeIn">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-moisture"></i> Humidity (%)</h5>
                        <canvas id="humidityChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow animate__fadeIn">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-cloud-sun-fill"></i> Hourly Temperature Forecast (°C)</h5>
                        <canvas id="hourlyTempChart" height="200"></canvas>
                    </div>
                </div>
                <div class="card shadow mt-4 animate__fadeIn">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-list-check"></i> Safety Recommendations</h5>
                        <ul class="list-group">
                            {% for rec in recommendations %}
                                <li class="list-group-item d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2"></i> {{ rec }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <a href="/" class="btn btn-secondary btn-lg d-block mx-auto mt-4"><i class="bi bi-arrow-left"></i> Check Another Location</a>
    </div>
    <script>
        // Hourly Temperature Chart (Line)
        try {
            const hourlyTimes = {{ hourly_times | safe }} || [];
            const hourlyTemps = {{ hourly_temps | safe }} || [];
            if (hourlyTimes.length && hourlyTemps.length) {
                const hourlyCtx = document.getElementById('hourlyTempChart').getContext('2d');
                new Chart(hourlyCtx, {
                    type: 'line',
                    data: {
                        labels: hourlyTimes,
                        datasets: [{
                            label: 'Temperature (°C)',
                            data: hourlyTemps,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.2)',
                            borderWidth: 2,
                            fill: true
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: false }
                        }
                    }
                });
            } else {
                console.error('No hourly data available');
                document.getElementById('hourlyTempChart').parentElement.innerHTML = '<p class="text-danger">Hourly forecast data unavailable.</p>';
            }
        } catch (e) {
            console.error('Error rendering hourly chart:', e);
            document.getElementById('hourlyTempChart').parentElement.innerHTML = '<p class="text-danger">Error rendering chart.</p>';
        }

        // UV Index Chart (Doughnut)
        try {
            const uvi = {{ uvi }} || 0;
            const uvCtx = document.getElementById('uvChart').getContext('2d');
            new Chart(uvCtx, {
                type: 'doughnut',
                data: {
                    labels: ['UV Index'],
                    datasets: [{
                        label: 'UV Index',
                        data: [uvi, 11 - uvi],
                        backgroundColor: [uvi > 3 ? '#dc3545' : '#28a745', 'rgba(211, 211, 211, 0.2)'],
                        borderColor: [uvi > 3 ? '#dc3545' : '#28a745', 'rgba(211, 211, 211, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    cutout: '60%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
            uvCtx.font = "bold 20px Arial";
            uvCtx.fillStyle = "#333";
            uvCtx.textAlign = "center";
            uvCtx.textBaseline = "middle";
            uvCtx.fillText(uvi.toFixed(1), uvCtx.canvas.width / 2, uvCtx.canvas.height / 2);
        } catch (e) {
            console.error('Error rendering UV chart:', e);
            document.getElementById('uvChart').parentElement.innerHTML = '<p class="text-danger">Error rendering chart.</p>';
        }

        // Humidity Chart (Bar)
        try {
            const humidity = {{ humidity }} || 0;
            const humidityCtx = document.getElementById('humidityChart').getContext('2d');
            new Chart(humidityCtx, {
                type: 'bar',
                data: {
                    labels: ['Humidity'],
                    datasets: [{
                        label: 'Humidity (%)',
                        data: [humidity],
                        backgroundColor: humidity > 80 ? '#dc3545' : '#007bff',
                        borderColor: humidity > 80 ? '#dc3545' : '#007bff',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        } catch (e) {
            console.error('Error rendering humidity chart:', e);
            document.getElementById('humidityChart').parentElement.innerHTML = '<p class="text-danger">Error rendering chart.</p>';
        }
    </script>
</body>
</html>